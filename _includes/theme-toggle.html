<!-- Theme Switcher Component -->
<div
  class="theme-toggle"
  id="theme-toggle"
>
  <button
    class="theme-btn"
    data-theme="auto"
    title="Auto (System)"
    aria-label="Auto theme based on system preference"
  >
    <i class="fas fa-adjust"></i>
  </button>
  <button
    class="theme-btn"
    data-theme="light"
    title="Light Mode"
    aria-label="Light theme"
  >
    <i class="fas fa-sun"></i>
  </button>
  <button
    class="theme-btn"
    data-theme="dark"
    title="Dark Mode"
    aria-label="Dark theme"
  >
    <i class="fas fa-moon"></i>
  </button>
</div>

<!-- Theme System Initialization -->
<script>
  // Immediate theme initialization to prevent flash
  (function () {
    'use strict';

    // Get saved theme preference or default to auto
    const savedTheme = localStorage.getItem('theme') || 'auto';
    let effectiveTheme = savedTheme;

    // Determine effective theme for auto mode
    if (savedTheme === 'auto') {
      effectiveTheme =
        window.matchMedia &&
        window.matchMedia('(prefers-color-scheme: dark)').matches
          ? 'dark'
          : 'light';
    }

    // Apply theme immediately
    const html = document.documentElement;
    const body = document.body;

    // Remove any existing theme classes
    html.classList.remove('theme-light', 'theme-dark', 'theme-auto');
    body.classList.remove('theme-light', 'theme-dark');

    // Add current theme classes
    html.classList.add(`theme-${savedTheme}`);
    body.classList.add(`theme-${effectiveTheme}`);
    html.setAttribute('data-theme', effectiveTheme);

    // Update meta theme-color for mobile browsers
    let metaThemeColor = document.querySelector('meta[name="theme-color"]');
    if (!metaThemeColor) {
      metaThemeColor = document.createElement('meta');
      metaThemeColor.name = 'theme-color';
      document.head.appendChild(metaThemeColor);
    }

    const themeColors = {
      light: '#ffffff',
      dark: '#1a1a1a',
    };

    metaThemeColor.content = themeColors[effectiveTheme] || themeColors.light;
  })();
</script>

<!-- Load theme switcher when DOM is ready -->
<script
  src="{{ '/assets/js/theme-switcher.js' | relative_url }}"
  defer
></script>

<!-- Additional CSS for immediate theme application -->
<style>
  /* Critical CSS to prevent flash of unstyled content */
  html {
    color-scheme: light dark;
  }

  html[data-theme='dark'] {
    color-scheme: dark;
  }

  html[data-theme='light'] {
    color-scheme: light;
  }

  /* Enhanced theme toggle positioning */
  .greedy-nav .theme-toggle {
    margin-left: auto;
    padding-left: 1rem;
  }

  @media (max-width: 768px) {
    .greedy-nav .theme-toggle {
      position: fixed;
      top: 1rem;
      right: 1rem;
      z-index: 1001;
      background: var(--mm-background-color, #fff);
      padding: 0.25rem;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      border: 1px solid var(--mm-border-color, #e9ecef);
    }
  }
</style>
